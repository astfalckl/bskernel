<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>ML with Gaussian Likelihood â€¢ bskernel</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="â€image/svg+xmlâ€" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="ML with Gaussian Likelihood">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">bskernel</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/ml_gaussian.html">ML with Gaussian Likelihood</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>ML with Gaussian Likelihood</h1>
            
      

      <div class="d-none name"><code>ml_gaussian.Rmd</code></div>
    </div>

    
    
<p>We begin by illustrating a simple example of fitting an ACF to
simulated time-series data using maximum likelihood. We simulate a
stationary Gaussian process with a known MatÃ©rn-3/2 auto-covariance
structure. Then, we fit an auto-covariance model using the
<code>bskernel</code> package, assuming linear
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">k=1</annotation></semantics></math>)
B-spline spectral basis. The resulting estimated ACF is compared to the
true model.</p>
<p>In what follows, as we sample our data regularly, we use Toeplitz
tricks to speed matters up. Generalising to non-regular data is trivial,
it will just take longer for the optimiser to compute.</p>
<hr>
<div class="section level3">
<h3 id="simulate-a-gaussian-process-with-known-autocovariance">Simulate a Gaussian process with known autocovariance<a class="anchor" aria-label="anchor" href="#simulate-a-gaussian-process-with-known-autocovariance"></a>
</h3>
<p>Most of this is standard; we lean on the package
<code>SuperGauss</code> to efficiently sample the GP and set
<code>fft = FALSE</code> so that this sample is an exact draw.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://astfalckl.github.io/bskernel/">bskernel</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">SuperGauss</span><span class="op">)</span></span>
<span></span>
<span><span class="va">matern32_cov</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">d</span>, <span class="va">range</span>, <span class="va">sigma2</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">sqrt3_d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span> <span class="op">*</span> <span class="va">d</span> <span class="op">/</span> <span class="va">range</span></span>
<span>  <span class="va">sigma2</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">sqrt3_d</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">sqrt3_d</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">2000</span></span>
<span><span class="va">n_knots</span> <span class="op">&lt;-</span> <span class="fl">4</span></span>
<span><span class="va">range</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">k</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">b</span> <span class="op">&lt;-</span> <span class="fl">0.1</span></span>
<span></span>
<span><span class="va">tau</span> <span class="op">&lt;-</span> <span class="fl">0</span><span class="op">:</span><span class="op">(</span><span class="va">n</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">mat32_acf</span> <span class="op">&lt;-</span> <span class="fu">matern32_cov</span><span class="op">(</span><span class="va">tau</span>, <span class="va">range</span>, sigma2 <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu">SuperGauss</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SuperGauss/man/rnormtz.html" class="external-link">rnormtz</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1</span>, <span class="va">mat32_acf</span>, fft <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<hr>
</div>
<div class="section level3">
<h3 id="estimate-the-acf-using-spline-kernels">Estimate the ACF using spline kernels<a class="anchor" aria-label="anchor" href="#estimate-the-acf-using-spline-kernels"></a>
</h3>
<p>There are a couple of things to note here. First, the data are
sampled regularly with spacing 1, so the Nyquist frequency is 0.5. We
extend the knot spacing past this as we are using linear basis. Same
with the first knot, we are creating a symmetry about 0. Next,
<code>optim_toeplitz_mle</code> is optimising over the log space of the
parameters, hence why we must exponentiate the optimiser output.
Constraining the parameters to be positive like this is a sufficient but
not necessary condition to yield a positive semi-definite estimate.
Finally, the easiest way to symmetrise the bases defined by the knots is
to just take the real values.</p>
<p>The plot of the estimated vs true ACF is given below.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">knots</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.05</span>, <span class="fl">0</span>, <span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.3</span>, <span class="fl">0.5</span>, <span class="fl">0.7</span><span class="op">)</span></span>
<span><span class="va">c_init</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.3</span>, <span class="fl">0.2</span>, <span class="fl">0.15</span>, <span class="fl">0.15</span>, <span class="fl">0.1</span>, <span class="fl">0.1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">log_c_mle</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/optim_toeplitz_mle.html">optim_toeplitz_mle</a></span><span class="op">(</span><span class="va">c_init</span>, <span class="va">knots</span>, <span class="va">k</span>, <span class="va">y</span><span class="op">)</span><span class="op">$</span><span class="va">par</span></span>
<span><span class="va">c_mle</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">log_c_mle</span><span class="op">)</span></span>
<span><span class="va">acf_est</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/reconstruct_acf.html">reconstruct_acf</a></span><span class="op">(</span><span class="va">c_mle</span>, <span class="va">knots</span>, <span class="va">k</span>, <span class="va">tau</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/complex.html" class="external-link">Re</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="ml_gaussian_files/figure-html/unnamed-chunk-5-1.png" width="480"></p>
<hr>
</div>
<div class="section level3">
<h3 id="gradient-of-the-toeplitz-representation">Gradient of the Toeplitz Representation<a class="anchor" aria-label="anchor" href="#gradient-of-the-toeplitz-representation"></a>
</h3>
<p>Warning: mathematical details not required to run the code.</p>
<p>This optimisation runs efficiently in part as we have baked in the
gradient using the Toeplitz representation of the likelihood. See
<code>compute_toeplitz_loglik_grad</code> if you want to unpack
this.</p>
<p>Let
<strong><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ğ²</mi><mo>âˆˆ</mo><msup><mi>â„</mi><mi>n</mi></msup></mrow><annotation encoding="application/x-tex">\mathbf{y} \in \mathbb{R}^n</annotation></semantics></math></strong>
be a zero-mean stationary Gaussian process with Toeplitz covariance
matrix
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Î£</mi><mo>=</mo><mi>T</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>ğ›’</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
\Sigma = T(\boldsymbol{\rho})
</annotation></semantics></math> where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>ğ›’</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">T(\boldsymbol{\rho})</annotation></semantics></math>
is a symmetric Toeplitz matrix defined by the autocovariance vector
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ğ›’</mi><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Ï</mi><mn>0</mn></msub><mo>,</mo><msub><mi>Ï</mi><mn>1</mn></msub><mo>,</mo><mi>â€¦</mi><mo>,</mo><msub><mi>Ï</mi><mrow><mi>n</mi><mo>âˆ’</mo><mn>1</mn></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\boldsymbol{\rho} = (\rho_0, \rho_1, \dots, \rho_{n-1})</annotation></semantics></math>.
We model each autocovariance entry as
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Ï</mi><mi>Ï„</mi></msub><mo>=</mo><munderover><mo>âˆ‘</mo><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mrow><mi>m</mi><mo>âˆ’</mo><mn>1</mn></mrow></munderover><msub><mi>c</mi><mi>i</mi></msub><mspace width="0.167em"></mspace><msub><mi>Ï•</mi><mi>i</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>Ï„</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
\rho_\tau = \sum_{i=0}^{m-1} c_i \, \phi_i(\tau)
</annotation></semantics></math> where</p>
<ul>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>c</mi><mi>i</mi></msub><annotation encoding="application/x-tex">c_i</annotation></semantics></math>
are coefficients,</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Ï•</mi><mi>i</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>Ï„</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\phi_i(\tau)</annotation></semantics></math>
is the inverse Fourier transform of the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>-th
B-spline spectral basis function (eqn 5 of the paper).</li>
</ul>
<p>The log-likelihood is
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>â„“</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>ğœ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mo>âˆ’</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mrow><mo stretchy="true" form="prefix">[</mo><mi>n</mi><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>2</mn><mi>Ï€</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mo>log</mo><mrow><mo stretchy="true" form="prefix">|</mo><mi>Î£</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>ğœ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">|</mo></mrow><mo>+</mo><msup><mi>ğ²</mi><mi>âŠ¤</mi></msup><mi>Î£</mi><msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>ğœ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo>âˆ’</mo><mn>1</mn></mrow></msup><mi>ğ²</mi><mo stretchy="true" form="postfix">]</mo></mrow><mi>.</mi></mrow><annotation encoding="application/x-tex">
\ell(\mathbf{c}) = -\frac{1}{2} \left[ n \log(2\pi) + \log |\Sigma(\mathbf{c})| + \mathbf{y}^\top \Sigma(\mathbf{c})^{-1} \mathbf{y} \right].
</annotation></semantics></math></p>
<p>Apply the chain rule,
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mrow><mi>âˆ‚</mi><mo>â„“</mo></mrow><mrow><mi>âˆ‚</mi><msub><mi>c</mi><mi>i</mi></msub></mrow></mfrac><mo>=</mo><munderover><mo>âˆ‘</mo><mrow><mi>Ï„</mi><mo>=</mo><mn>0</mn></mrow><mrow><mi>n</mi><mo>âˆ’</mo><mn>1</mn></mrow></munderover><mfrac><mrow><mi>âˆ‚</mi><mo>â„“</mo></mrow><mrow><mi>âˆ‚</mi><msub><mi>Ï</mi><mi>Ï„</mi></msub></mrow></mfrac><mo>â‹…</mo><mfrac><mrow><mi>âˆ‚</mi><msub><mi>Ï</mi><mi>Ï„</mi></msub></mrow><mrow><mi>âˆ‚</mi><msub><mi>c</mi><mi>i</mi></msub></mrow></mfrac><mi>.</mi></mrow><annotation encoding="application/x-tex">
\frac{\partial \ell}{\partial c_i} = \sum_{\tau=0}^{n-1} \frac{\partial \ell}{\partial \rho_\tau} \cdot \frac{\partial \rho_\tau}{\partial c_i}.
</annotation></semantics></math> From standard matrix calculus,
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mrow><mi>âˆ‚</mi><mo>â„“</mo></mrow><mrow><mi>âˆ‚</mi><msub><mi>Ï</mi><mi>Ï„</mi></msub></mrow></mfrac><mo>=</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mrow><mo stretchy="true" form="prefix">[</mo><msup><mi>ğ²</mi><mi>âŠ¤</mi></msup><msup><mi>Î£</mi><mrow><mo>âˆ’</mo><mn>1</mn></mrow></msup><msup><mi>J</mi><mi>Ï„</mi></msup><msup><mi>Î£</mi><mrow><mo>âˆ’</mo><mn>1</mn></mrow></msup><mi>ğ²</mi><mo>âˆ’</mo><mo>tr</mo><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>Î£</mi><mrow><mo>âˆ’</mo><mn>1</mn></mrow></msup><msup><mi>J</mi><mi>Ï„</mi></msup><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">
\frac{\partial \ell}{\partial \rho_\tau} = \frac{1}{2} \left[ \mathbf{y}^\top \Sigma^{-1} J^\tau \Sigma^{-1} \mathbf{y} - \operatorname{tr}(\Sigma^{-1} J^\tau) \right]
</annotation></semantics></math> where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>J</mi><mi>Ï„</mi></msup><annotation encoding="application/x-tex">J^\tau</annotation></semantics></math>
is the Toeplitz matrix with 1s on the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Ï„</mi><annotation encoding="application/x-tex">\tau</annotation></semantics></math>-th
(symmetric) off-diagonal, and 0 elsewhere. In practice, this is
efficiently handled by the <code><a href="https://rdrr.io/pkg/SuperGauss/man/NormalToeplitz.html" class="external-link">SuperGauss::NormalToeplitz</a></code>
class. Since,
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Ï</mi><mi>Ï„</mi></msub><mo>=</mo><munder><mo>âˆ‘</mo><mi>i</mi></munder><msub><mi>c</mi><mi>i</mi></msub><mspace width="0.167em"></mspace><msub><mi>Ï•</mi><mi>i</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>Ï„</mi><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="1.0em"></mspace><mo>â‡’</mo><mspace width="1.0em"></mspace><mfrac><mrow><mi>âˆ‚</mi><msub><mi>Ï</mi><mi>Ï„</mi></msub></mrow><mrow><mi>âˆ‚</mi><msub><mi>c</mi><mi>i</mi></msub></mrow></mfrac><mo>=</mo><msub><mi>Ï•</mi><mi>i</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>Ï„</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">
\rho_\tau = \sum_i c_i \, \phi_i(\tau)
\quad \Rightarrow \quad
\frac{\partial \rho_\tau}{\partial c_i} = \phi_i(\tau),
</annotation></semantics></math> the Jacobian
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>âˆ‚</mi><mi>ğ›’</mi><mi>/</mi><mi>âˆ‚</mi><mi>ğœ</mi><mo>âˆˆ</mo><msup><mi>â„</mi><mrow><mi>n</mi><mo>Ã—</mo><mi>K</mi></mrow></msup></mrow><annotation encoding="application/x-tex">\partial \boldsymbol{\rho} / \partial \mathbf{c} \in \mathbb{R}^{n \times K}</annotation></semantics></math>
has entries
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mrow><mo stretchy="true" form="prefix">[</mo><mfrac><mrow><mi>âˆ‚</mi><mi>ğ›’</mi></mrow><mrow><mi>âˆ‚</mi><mi>ğœ</mi></mrow></mfrac><mo stretchy="true" form="postfix">]</mo></mrow><mrow><mi>Ï„</mi><mo>,</mo><mi>i</mi></mrow></msub><mo>=</mo><msub><mi>Ï•</mi><mi>i</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>Ï„</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>.</mi></mrow><annotation encoding="application/x-tex">
\left[ \frac{\partial \boldsymbol{\rho}}{\partial \mathbf{c}} \right]_{\tau,i} = \phi_i(\tau).
</annotation></semantics></math></p>
<p>Putting it together,
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>âˆ‡</mi><mi>ğœ</mi></msub><mo>â„“</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>ğœ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><mfrac><mrow><mi>âˆ‚</mi><mo>â„“</mo></mrow><mrow><mi>âˆ‚</mi><mi>ğ›’</mi></mrow></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><mi>âŠ¤</mi></msup><mo>â‹…</mo><mrow><mo stretchy="true" form="prefix">(</mo><mfrac><mrow><mi>âˆ‚</mi><mi>ğ›’</mi></mrow><mrow><mi>âˆ‚</mi><mi>ğœ</mi></mrow></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><mi>.</mi></mrow><annotation encoding="application/x-tex">
\nabla_{\mathbf{c}} \ell(\mathbf{c}) = \left( \frac{\partial \ell}{\partial \boldsymbol{\rho}} \right)^\top \cdot \left( \frac{\partial \boldsymbol{\rho}}{\partial \mathbf{c}} \right).
</annotation></semantics></math> In code, <code>SuperGauss</code>
handles this all beautifully with</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">grad</span> <span class="op">&lt;-</span> <span class="va">nt</span><span class="op">$</span><span class="fu">grad</span><span class="op">(</span>z <span class="op">=</span> <span class="va">y</span>, dz <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n</span>, <span class="va">n_basis</span><span class="op">)</span>, acf <span class="op">=</span> <span class="va">rho</span>, dacf <span class="op">=</span> <span class="va">dacf</span><span class="op">)</span></span></code></pre></div>
<p>Lastly, if we optimise over the log-parameters
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Î¸</mi><mi>i</mi></msub><mo>=</mo><mo>log</mo><msub><mi>c</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\theta_i = \log c_i</annotation></semantics></math>,
the chain rule gives
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mrow><mi>âˆ‚</mi><mo>â„“</mo></mrow><mrow><mi>âˆ‚</mi><msub><mi>Î¸</mi><mi>i</mi></msub></mrow></mfrac><mo>=</mo><mfrac><mrow><mi>âˆ‚</mi><mo>â„“</mo></mrow><mrow><mi>âˆ‚</mi><msub><mi>c</mi><mi>i</mi></msub></mrow></mfrac><mo>â‹…</mo><mfrac><mrow><mi>âˆ‚</mi><msub><mi>c</mi><mi>i</mi></msub></mrow><mrow><mi>âˆ‚</mi><msub><mi>Î¸</mi><mi>i</mi></msub></mrow></mfrac><mo>=</mo><mfrac><mrow><mi>âˆ‚</mi><mo>â„“</mo></mrow><mrow><mi>âˆ‚</mi><msub><mi>c</mi><mi>i</mi></msub></mrow></mfrac><mo>â‹…</mo><msub><mi>c</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">
\frac{\partial \ell}{\partial \theta_i} = \frac{\partial \ell}{\partial c_i} \cdot \frac{\partial c_i}{\partial \theta_i} = \frac{\partial \ell}{\partial c_i} \cdot c_i
</annotation></semantics></math> and so in code,</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">grad_theta</span> <span class="op">&lt;-</span> <span class="va">grad</span> <span class="op">*</span> <span class="va">c</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Lachlan Astfalck.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
